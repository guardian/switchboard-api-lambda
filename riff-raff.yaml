regions: [eu-west-1]
stacks: [cms-fronts]
templates:
  lambda:
    type: aws-lambda
    contentDirectory: switchboardApiLambda
    parameters:
      prefixStack: false
      bucket: facia-dist
      fileName: switchboardApiLambda.zip

deployments:

  switchboardStatic:
    type: aws-s3
    parameters:
      bucket: cms-fronts-static-assets
      cacheControl:
        - pattern: .*\\.js$
          value: public, max-age=315360000
        - pattern: .*\\.css$
          value: public, max-age=315360000
        - pattern: .*\\.jpg$
          value: public, max-age=315360000
        - pattern: .*
          value: public, max-age=60
      mimeTypes: {
        "js": "application/javascript",
        "css": "text/css",
        "jpg": "image/jpeg"
      }
      prefixStack: false
  
  switchesLambdaUpload:
    template: lambda
    actions: [uploadLambda]
    parameters:
      functionNames:
        - "switches-lambda-switchboard-api-"
    dependencies:
     - switchboardStatic

  statusLambdaUpload:
    template: lambda
    actions: [uploadLambda]
    parameters:
      functionNames:
        - "status-lambda-switchboard-api-"
    dependencies:
     - switchboardStatic

  toggleLambdaUpload:
    template: lambda
    actions: [uploadLambda]
    parameters:
      functionNames:
        - "status-lambda-switchboard-api-"
    dependencies:
     - switchboardStatic

  switchesLambdaUpdate:
    template: lambda
    actions: [updateLambda]
    parameters:
      functionNames:
        - "switches-lambda-switchboard-api-"
    dependencies:
     - switchboardStatic
     - switchesLambdaUpload

  statusLambdaUpdate:
    template: lambda
    actions: [updateLambda]
    parameters:
      functionNames:
        - "status-lambda-switchboard-api-"
    dependencies:
     - switchboardStatic
     - statusLambdaUpload

  toggleLambdaUpdate:
    template: lambda
    actions: [updateLambda]
    parameters:
      functionNames:
        - "status-lambda-switchboard-api-"
    dependencies:
     - switchboardStatic
     - toggleLambdaUpload
